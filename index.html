<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Å¥„Åà„ÇìÂõûÈÅø„Ç≤„Éº„É†</title>
  <style>
    body {
      margin: 0;
      background: #111;
      font-family: sans-serif;
      color: white;
      text-align: center;
    }

    #game {
      position: relative;
      width: 320px;
      height: 480px;
      margin: 30px auto;
      background: black;
      border: 2px solid white;
      overflow: hidden;
    }

    #player {
      position: absolute;
      bottom: 10px;
      left: 145px;
      width: 30px;
      height: 30px;
      background: lime;
      border-radius: 5px;
    }

    .obstacle {
      position: absolute;
      width: 30px;
      height: 30px;
      font-size: 24px;
      text-align: center;
      line-height: 30px;
    }

    #hud {
      margin-top: 10px;
      font-size: 18px;
    }

    #gameover {
      color: red;
      font-size: 28px;
      margin-top: 20px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ü•∫„ÇíÈÅø„Åë„Çç</h1>
  <div id="game">
    <div id="player"></div>
  </div>
  <div id="hud">
    ‚ù§Ô∏è „É©„Ç§„Éï: <span id="lives">3</span>„ÄÄ
    üßÆ „Çπ„Ç≥„Ç¢: <span id="score">0</span>
  </div>
  <div id="gameover">üíÄ GAME OVER üíÄ<br><button onclick="location.reload()">„É™„Éà„É©„Ç§</button></div>

  <!-- BGM -->
  <audio id="bgm" src="„Äå„Å≤„Çö„Åà„Çì„Äç„ÅÆ„ÅÜ„Åü_(Short_Version).mp3" loop></audio>

  <script>
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const livesDisplay = document.getElementById("lives");
    const scoreDisplay = document.getElementById("score");
    const gameOverText = document.getElementById("gameover");
    const bgm = document.getElementById("bgm");

    let playerX = 145;
    let lives = 3;
    let score = 0;
    let gameSpeed = 2;
    let isGameOver = false;

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    // ÊúÄÂàù„ÅÆÊìç‰Ωú„ÅßBGMÂÜçÁîü
    document.addEventListener('keydown', () => {
      if (bgm.paused) bgm.play();
    }, { once: true });

    function movePlayer() {
      if (keys["ArrowLeft"] && playerX > 0) playerX -= 5;
      if (keys["ArrowRight"] && playerX < 290) playerX += 5;
      player.style.left = playerX + "px";
    }

    function createObstacle() {
      const obs = document.createElement("div");
      obs.classList.add("obstacle");
      obs.textContent = "ü•∫"; // ‚Üê„Åì„Åì„Å†„ÅëÂ§âÊõ¥ÔºÅ
      obs.style.left = Math.floor(Math.random() * 290) + "px";
      obs.style.top = "0px";
      game.appendChild(obs);
      return obs;
    }

    const obstacles = [];

    function updateObstacles() {
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        let y = parseInt(obs.style.top);
        y += gameSpeed;
        obs.style.top = y + "px";

        const ox = parseInt(obs.style.left);
        const oy = y;
        const px = playerX;
        const py = 440;

        if (
          px < ox + 30 &&
          px + 30 > ox &&
          py < oy + 30 &&
          py + 30 > oy
        ) {
          lives--;
          livesDisplay.textContent = lives;
          game.removeChild(obs);
          obstacles.splice(i, 1);
          if (lives <= 0) {
            endGame();
            return;
          }
        }

        if (y > 480) {
          game.removeChild(obs);
          obstacles.splice(i, 1);
        }
      }

      // Âæê„ÄÖ„Å´„Çπ„Éî„Éº„Éâ„Ç¢„ÉÉ„Éó
      if (score % 10 === 0 && score !== 0) {
        gameSpeed += 0.02;
      }
    }

    function endGame() {
      isGameOver = true;
      gameOverText.style.display = "block";
      bgm.pause();
      bgm.currentTime = 0;
    }

    function gameLoop() {
      if (isGameOver) return;
      movePlayer();
      updateObstacles();

      if (Math.random() < 0.03) {
        obstacles.push(createObstacle());
      }

      requestAnimationFrame(gameLoop);
    }

    setInterval(() => {
      if (!isGameOver) {
        score++;
        scoreDisplay.textContent = score;
      }
    }, 1000);

    gameLoop();
  </script>
</body>
</html>
